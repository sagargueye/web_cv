System.register(["./chunk-vendor.js","./chunk-frameworks.js"],function(){"use strict";var l,f,d,u,m,p,g;return{setters:[function(n){l=n.t,f=n.c,d=n.T,u=n.p},function(n){m=n.V,p=n.S,g=n.r}],execute:function(){var n=Object.defineProperty,j=Object.getOwnPropertyDescriptor,P=(e,t)=>n(e,"name",{value:t,configurable:!0}),o=(e,t,i,r)=>{for(var a=r>1?void 0:r?j(t,i):t,c=e.length-1,h;c>=0;c--)(h=e[c])&&(a=(r?h(t,i,a):h(a))||a);return r&&a&&n(t,i,a),a};let s=class extends HTMLElement{constructor(){super(...arguments);this.loading=!0,this.isAllProjectsMode=!1,this.recentSrc="",this.allSrc="",this.selectionDiff={},this.hashedItemScore=new Map}connectedCallback(){var e;this.recentSrc=this.filterElement.src,this.allSrc=this.all.getAttribute("data-src")||"",this.filterElement.filter=(i,r)=>{if(!r)return!0;const a=`${i.name.trim().toLowerCase()}`,c=m(a,r),h=c>0?{score:c,text:a}:null;return h&&this.hashedItemScore.set(i,h),c>0};const t=this.closest("details.select-menu");t&&this.list&&t.addEventListener("toggle",this.toggleProjectMenu.bind(this)),this.filterElement.addEventListener("virtual-filter-input-filtered",()=>this.filterDone()),(e=this.filterElement.input)==null||e.addEventListener("keydown",i=>{i.key==="Enter"&&i.preventDefault()})}filterDone(){this.list.sort((e,t)=>{const i=this.hashedItemScore.get(t),r=this.hashedItemScore.get(e);return!r&&!i?0:r?i?p(r,i):-1:1})}switchMode(){const e=this.filterInput.value.length>0;e&&this.filterElement.src!==this.allSrc?this.switchToAllProjectsMode():!e&&this.filterElement.src!==this.recentSrc&&this.switchToRecentProjectMode()}switchToAllProjectsMode(){this.filterElement.src=this.allSrc,this.filterElement.loading="eager",this.isAllProjectsMode=!0}switchToRecentProjectMode(){this.filterElement.src=this.recentSrc,this.filterElement.loading="eager",this.isAllProjectsMode=!1}showAllProjectsBlankslate(){this.blankslateAllProjects.hidden=!1}hideAllProjectsBlankslate(){this.blankslateAllProjects.hidden=!0}showRecentProjectsBlankslate(){this.blankslateRecentProjects.hidden=!1}hideRecentProjectsBlankslate(){this.blankslateRecentProjects.hidden=!0}showBlankslate(){this.isAllProjectsMode?this.showAllProjectsBlankslate():this.showRecentProjectsBlankslate()}hideBlankslate(){this.isAllProjectsMode?this.hideAllProjectsBlankslate():this.hideRecentProjectsBlankslate()}showLoadingIndicator(){this.loadingIndicator.removeAttribute("hidden")}hideLoadingIndicator(){this.loadingIndicator.setAttribute("hidden","true")}willLoad(){this.loading=!0,this.showLoadingIndicator(),this.hideAllProjectsBlankslate(),this.hideRecentProjectsBlankslate(),this.filterElement.reset()}didLoad(){this.loading=!1,this.hideLoadingIndicator()}willRenderItems(){this.loading||(this.list.size===0?this.showBlankslate():this.hideBlankslate())}renderItem(e){e.detail.fragment.append(this.createItem(e))}toggleItem(e){if(!(e.target instanceof HTMLInputElement)||e.target.type!=="checkbox")return;const t=e.target.closest("[data-project-number]");if(!t)return;const i=parseInt(t.getAttribute("data-project-number")||"",10);(t.getAttribute("aria-checked")||"")==="true"?(this.selectionDiff[i]=!1,t.setAttribute("aria-checked","false")):(this.selectionDiff[i]=!0,t.setAttribute("aria-checked","true")),this.serializeSelection()}isProjectSelected(e){var t;return(t=this.selectionDiff[e.number])!=null?t:e.selected}toggleProjectMenu(e){if(!e.target)return;if(e.target.open)return this.onMenuOpen();this.onMenuClosed(e)}onMenuOpen(){this.list.update(),this.loading===!1&&this.list.size===0&&this.filterElement.load()}onMenuClosed(e){this.filterElement.clear();const i=e.currentTarget.closest(".js-repo-project-picker-form");for(const r of i.elements)if((r.getAttribute("name")||"").indexOf("repo_memex_link")>-1){g(i);return}}createSubmitSelection(e,t){return new d(this.selectionTemplate,{name:`repo_memex_link[${e.toString()}]`,checked:t,type:t?"checkbox":"hidden"},u)}serializeSelection(){this.submitContainer.replaceChildren();for(const[e,t]of Object.entries(this.selectionDiff))this.submitContainer.append(this.createSubmitSelection(e,t))}createItem(e){return new d(this.itemTemplate,{number:e.detail.item.number,name:e.detail.item.name,owner:e.detail.item.owner,selected:this.isProjectSelected(e.detail.item)},u)}};P(s,"MemexProjectPickerElement"),o([l],s.prototype,"filterElement",2),o([l],s.prototype,"list",2),o([l],s.prototype,"itemTemplate",2),o([l],s.prototype,"selectionTemplate",2),o([l],s.prototype,"submitContainer",2),o([l],s.prototype,"blankslateAllProjects",2),o([l],s.prototype,"blankslateRecentProjects",2),o([l],s.prototype,"all",2),o([l],s.prototype,"filterInput",2),o([l],s.prototype,"loadingIndicator",2),s=o([f],s)}}});
//# sourceMappingURL=chunk-memex-project-picker-element-d044f54f.js.map
