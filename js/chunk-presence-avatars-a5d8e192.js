System.register(["./chunk-vendor.js","./chunk-frameworks.js"],function(){"use strict";var p,y,m,b;return{setters:[function(i){p=i.t,y=i.c},function(i){m=i.c,b=i.ah}],execute:function(){var i=Object.defineProperty,I=Object.getOwnPropertyDescriptor,h=(s,r)=>i(s,"name",{value:r,configurable:!0}),A=(s,r,d,l)=>{for(var e=l>1?void 0:l?I(r,d):r,a=s.length-1,c;a>=0;a--)(c=s[a])&&(e=(l?c(r,d,e):c(e))||e);return l&&e&&i(r,d,e),e};const f={two:"AvatarStack--two",threePlus:"AvatarStack--three-plus"};let v=class extends HTMLElement{constructor(){super(...arguments);this.avatarsByUserId=new Map}connectedCallback(){const s=this.avatar.parentElement,r=this.avatar;if(r.hidden=!0,this.hidden=!1,!s)return;for(const e of Array.from(s.children))e!==r&&s.removeChild(e);this.classList.add("js-socket-channel");const d=h(e=>{const{userId:a,isOwnUser:c,isIdle:u}=e,n=b("PRESENCE_IDLE")&&u?"0.3":"1";let t=this.avatarsByUserId.get(a);t||(t=r.cloneNode(!0),t.src=t.src.replace(/u\/[0-9]+/,`u/${a}`),t.setAttribute("data-hovercard-url",`/hovercards?user_id=${a}`),t.hidden=!1,t.removeAttribute("data-target"),t.animate&&t.animate([{opacity:"0"},{opacity:n}],{duration:500,easing:"ease-in-out"}),c?s.appendChild(t):s.prepend(t)),t.style.transition="opacity 0.5s ease-in-out",t.style.opacity=n,this.avatarsByUserId.set(a,t)},"upsertAvatar"),l=h(e=>{const a=this.avatarsByUserId.get(e);a&&(s==null||s.removeChild(a),this.avatarsByUserId.delete(e))},"removeAvatar");this.subscription=m(this,"socket:presence",e=>{const{data:a}=e.detail,c=this.avatarsByUserId.keys(),u=new Set;for(const o of a)d(o),u.add(o.userId);for(const o of c)u.has(o)||l(o);const n=s.parentElement;for(const o of Object.values(f))n==null||n.classList.remove(o);const t=this.avatarsByUserId.size;t===2?n==null||n.classList.add(f.two):t>2&&(n==null||n.classList.add(f.threePlus))})}disconnectedCallback(){this.subscription&&this.subscription.unsubscribe()}};h(v,"PresenceAvatars"),A([p],v.prototype,"avatar",2),v=A([y],v)}}});
//# sourceMappingURL=chunk-presence-avatars-06c2c823.js.map
