System.register(["./chunk-vendor.js","./chunk-command-palette-item-element.js","./chunk-frameworks.js","./chunk-copy.js"],function(m){"use strict";var h,p,f,g,v,I,y;return{setters:[function(l){h=l.i,p=l.d,f=l.c},function(l){g=l.P,v=l.Q,I=l.C,y=l.a},function(){},function(){}],execute:function(){var l=Object.defineProperty,S=Object.getOwnPropertyDescriptor,b=(e,s)=>l(e,"name",{value:s,configurable:!0}),a=(e,s,t,r)=>{for(var i=r>1?void 0:r?S(s,t):s,n=e.length-1,c;n>=0;n--)(c=e[n])&&(i=(r?c(s,t,i):c(i))||i);return r&&i&&l(s,t,i),i};let o=m("CommandPalettePageElement",class extends HTMLElement{constructor(e={}){super();this.isRoot=!1,this.pageTitle="",this.queryText="",this.mode="",this.scopeId="",this.scopeType="",this.hasVisibleTip=!1,this.currentHeight=0,this.octicons={},this.requestsInProgress=[],this.tryDefaultSelection=!0,this.items={};const t={...{title:"",queryText:"",mode:"",scopeId:"",scopeType:"",hidden:!1},...e};this.pageTitle=t.title,this.queryText=t.queryText,this.mode=t.mode,this.scopeId=t.scopeId,this.scopeType=t.scopeType,this.hidden=t.hidden}get providers(){return this.documentProviders=[...this.serverDefinedProviderElements,...this.clientDefinedProviderElements],this.documentProviders?this.documentProviders:[]}get serverDefinedProviderElements(){const e=document.querySelectorAll("server-defined-provider");return Array.from(e)}get clientDefinedProviderElements(){const e=document.querySelectorAll("client-defined-provider");return Array.from(e)}get prefetchedProviders(){return this.providers.map(t=>t.provider).map(t=>t instanceof g?t:null).filter(t=>t!==null)}get scope(){return{text:this.pageTitle,type:this.scopeType,id:this.scopeId,tokens:[]}}get query(){return new v(this.queryText,this.mode,{scope:this.scope})}get selectedItem(){return this.findSelectedElement()}set selectedItem(e){const s=this.findSelectedElement();s&&(s.selected=!1),e&&(e.selected=!0,this.selectedItemChanged(e.item))}get groups(){return Array.from(this.querySelectorAll("command-palette-item-group"))}get visibleGroups(){return this.groups.filter(e=>!e.hidden)}get currentItems(){const e=this.items[this.query.path];return e?this.query.isBlank()?e.sort((s,t)=>t.priority-s.priority):e.sort((s,t)=>{const r=s.calculateScore(this.queryText);return t.calculateScore(this.queryText)-r||t.priority-s.priority}):[]}get firstItem(){const e=this.visibleGroups;if(e.length>0)return e[0].querySelector("command-palette-item")}get shouldSetDefaultSelection(){const e=this.query.isPresent();return this.tryDefaultSelection&&e}get isSelectedItemInvalid(){return!this.currentItems.some(e=>{var s;return e.id===((s=this.selectedItem)==null?void 0:s.itemId)})}updateSelectedItem(){this.isSelectedItemInvalid&&this.clearSelection(),this.setDefaultSelection()&&(this.selectedItem=this.firstItem)}setDefaultSelection(){const e=this.query.hasScope()||this.query.isPresent();return this.tryDefaultSelection&&e}clearSelection(){this.selectedItem=void 0}findSelectedElement(){return this.querySelector("command-palette-item[data-selected]")}findGroup(e){return this.groups.find(s=>s.groupId===e)}navigate(e){var s,t;this.tryDefaultSelection=!1;const r=e>0,i={behavior:"smooth",block:"nearest"};if(this.selectedItem){let n;if(r?n=(s=this.selectedItem)==null?void 0:s.nextElementSibling:n=(t=this.selectedItem)==null?void 0:t.previousElementSibling,n)this.selectedItem=n,this.selectedItem.scrollIntoView(i);else if(this.selectedItem){const c=this.visibleGroups[this.calculateIndex(e)];c.scrollIntoView(i),r?this.selectedItem=c.firstItem:this.selectedItem=c.lastItem}}else this.selectedItem=this.firstItem}calculateIndex(e){let s=this.visibleGroups.findIndex(i=>{var n;return i.groupId===((n=this.selectedItem)==null?void 0:n.item.group)});this.findGroup(I.topGroupId).firstItem===this.selectedItem&&(s=0);const t=s+e,r=this.visibleGroups.length;return(t%r+r)%r}async prefetch(){await this.fetchWithSpinner(this.prefetchedProviders.map(async e=>{!e.scopeMatch(this.query)||(await e.prefetch(this.query),e.octicons&&e.octicons.length>0&&this.cacheIcons(e.octicons,!0))})),this.fetch(this.prefetchedProviders.map(e=>e.element))}async fetch(e=this.providers){if(this.hidden)return;const s=this.query;await this.fetchWithSpinner(e.map(async t=>{if(!t.provider.enabledFor(s))return;const i=await t.fetchWithDebounce(s,!1);i&&(i.error,i.octicons&&i.octicons.length>0&&this.cacheIcons(i.octicons,!0),i.results.length>0&&(this.addItems(s,i.results),this.renderCurrentItems()))}))}async fetchWithSpinner(e){this.requestsInProgress.push(e),this.loadingStateChanged(!0),await Promise.all(e),this.requestsInProgress.splice(this.requestsInProgress.indexOf(e),1),this.loadingStateChanged(this.requestsInProgress.length>0)}addItems(e,s){e.path in this.items||(this.items[e.path]=[]),this.items[e.path].push(...s)}cacheIcons(e,s=!1){for(const t of e)this.octicons[t.id]=t.svg;s&&this.dispatchEvent(new CustomEvent("command-palette-page-octicons-cached",{bubbles:!0,detail:{octicons:e}}))}buildGroups(e){const t=["top",...new Set(e.map(i=>i.group))].map(i=>`command-palette-item-group[data-group-id="${i}"]`).join(","),r=document.querySelectorAll(t);for(const i of r)this.querySelector(`command-palette-item-group[data-group-id="${i.groupId}"]`)||this.append(i.cloneNode(!1))}setGroupBorders(){if(this.visibleGroups.length>0){this.visibleGroups[0].classList.remove("border-top");for(const e of this.visibleGroups)this.visibleGroups.indexOf(e)===0?(e.classList.remove("border-top"),e.header&&(e.classList.remove("py-2"),e.classList.add("mb-2"),this.hasVisibleTip?e.classList.remove("mt-3"):e.classList.add("mt-3"))):(e.classList.add("border-top"),e.header&&(e.classList.remove("mb-2","mt-3"),e.classList.add("py-2")))}}createItemElementAndRender(e,s,t){const r=new y;return r.setItemAttributes(e),r.render(s,t),r}renderCurrentItems(){this.reset();const e=this.currentItems,s=[];if(e&&e.length>0){this.buildGroups(e);for(const t of e){if(s.indexOf(t.id)>=0)continue;const r=t.calculateScore(this.queryText)+t.priority;let i=t.group;e.indexOf(t)===0&&r>o.TopResultThreshold&&(i="top");const n=this.createItemElementAndRender(t,!1,this.queryText),c=this.querySelector(`command-palette-item-group[data-group-id="${i}"]`);if(!c.atLimit){if(c.push(n),s.push(t.id),t.icon)if(t.icon.type==="octicon"){const d=this.octicons[t.icon.id],u=this.octicons["dash-color-fg-muted"];n.renderOcticon(d||u)}else t.icon.type==="avatar"&&n.renderAvatar(t.icon.url,t.icon.alt);else n.iconElement.hidden=!0;n.addEventListener("mousemove",d=>{var u;(d.movementX!==0||d.movementY!==0)&&((u=this.selectedItem)==null?void 0:u.itemId)!==n.itemId&&(this.tryDefaultSelection=!1,this.selectedItem=n)})}}this.shouldSetDefaultSelection&&(this.selectedItem=this.firstItem),this.recomputeStyles(),this.updateSelectedItem(),this.itemsUpdated()}}recomputeStyles(){this.setGroupBorders(),this.setMaxHeight()}get maximumHeight(){const t=window.innerHeight*.5;return Math.min(t,475)}get innerContentHeight(){let e=0;for(const s of this.children){const t=s,r=getComputedStyle(t),i=parseInt(r.marginTop.replace("px",""),10),n=parseInt(r.marginBottom.replace("px",""),10),c=t.offsetHeight+i+n;t.offsetHeight>0&&(e+=c)}return e}setMaxHeight(){const s=this.maximumHeight*.6,t=Math.round(Math.min(this.maximumHeight,this.innerContentHeight));Math.abs(this.currentHeight-t)>s?this.classList.add("no-transition"):this.classList.remove("no-transition"),this.setAttribute("style",`max-height:${t}px; min-height:${t}px;`),this.currentHeight=t}selectedItemChanged(e){const s=new CustomEvent("selectedItemChanged",{bubbles:!0,cancelable:!0,detail:{item:e,isDefaultSelection:this.tryDefaultSelection}});return this.dispatchEvent(s)}loadingStateChanged(e){const s=new CustomEvent("loadingStateChanged",{bubbles:!0,cancelable:!0,detail:{loading:e}});return this.dispatchEvent(s)}itemsUpdated(){const e=new CustomEvent("itemsUpdated",{bubbles:!0,cancelable:!0,detail:{items:this.currentItems,queryPath:this.query.immutableCopy().path}});return this.dispatchEvent(e)}reactivate(){this.hidden=!1,this.tryDefaultSelection=!0,this.queryText="",this.recomputeStyles(),this.prefetch()}reset(){this.tryDefaultSelection=!0,this.innerHTML=""}connectedCallback(){this.classList.add("rounded-bottom-2","page-stack-transition-height"),this.setAttribute("data-targets","command-palette-page-stack.pages"),this.setAttribute("style","max-height:400px;")}attributeChangedCallback(e,s,t){s!==t&&["data-mode","data-query-text"].includes(e)&&this.fetch()}});b(o,"CommandPalettePageElement"),o.TopResultThreshold=6.5,a([h],o.prototype,"isRoot",2),a([h],o.prototype,"pageTitle",2),a([h],o.prototype,"queryText",2),a([h],o.prototype,"mode",2),a([h],o.prototype,"scopeId",2),a([h],o.prototype,"scopeType",2),a([h],o.prototype,"hasVisibleTip",2),a([p(100)],o.prototype,"renderCurrentItems",1),o=m("CommandPalettePageElement",a([f],o))}}});
//# sourceMappingURL=chunk-command-palette-page-element-4e589a75.js.map
